{"name":"Vagrant-chef-server","tagline":"Setup a chef server with vagrant","body":"# Vagrant Chef Server\r\n\r\n# Requirements\r\n\r\nYou need the following.\r\n\r\n1. virtualbox (https://www.virtualbox.org)\r\n  - The latest VirtualBox platform packages.\r\n  - The latest VirtualBox Extension Pack.\r\n\r\n2. ruby (https://www.ruby-lang.org)\r\n  - I'm using version 2.0.0-p247 with rbenv/ruby-build (installed via homebrew)\r\n  - You have a great installation tutorial at https://github.com/sstephenson/rbenv#installation\r\n\r\n3. Chef (http://www.opscode.com)\r\n  - You have a great installation tutorial at https://learnchef.opscode.com/quickstart/workstation-setup/\r\n\r\n4. Vagrant (http://www.vagrantup.com)\r\n\r\n5. Omnibus Vagrant plugin (https://github.com/schisamo/vagrant-omnibus)\r\n  - In you terminal issue the command `vagrant plugin install vagrant-omnibus`\r\n\r\n5. Berkshelf Vagrant plugin (https://github.com/riotgames/vagrant-berkshelf)\r\n  - In you terminal issue the command `vagrant plugin install vagrant-berkshelf`\r\n\r\n# Quick Install\r\n\r\nFirst clone this repository then \r\n\r\n    $ bundle install --path vendor\r\n    $ berks install --path cookbooks\r\n    $ vagrant up\r\n\r\nVisit https://10.33.33.33/version to check if everything is working.\r\nThen https://10.33.33.33 to access the web interface (admin/p@ssw0rd1).\r\nChange to a secure password and regenerate certificates.\r\n\r\n# Do it yourself\r\n\r\n## Project Setup\r\n\r\nCreate and move to the project folder.\r\n\r\n    $ mkdir vagrant-chef-server\r\n    $ cd vagrant-chef-server\r\n    \r\nCreate a gem file.\r\n   \r\n    $ cat > Gemfile <<EOF\r\n    source \"https://rubygems.org\"\r\n\r\n    gem \"knife-solo\"\r\n    gem \"berkshelf\"\r\n \r\n    EOF\r\n\r\nInstall the gem locally to a new 'vendor' folder.  \r\n    \r\n    $ bundle install --path vendor\r\n    \r\nCreate a knife solo (a.k.a chef solo) folder structure.\r\n    \r\n    $ knife solo init .\r\n    \r\nCreate a Berkshelf file to manage cookbooks.\r\n    \r\n    $ cat > Berksfile <<EOF\r\n    site :opscode\r\n\r\n    cookbook 'chef-server'\r\n    \r\n    EOF\r\n\r\nInstall Berkshelf cookbooks.\r\n \r\n    $ berks install --path cookbooks\r\n    \r\n## Configure Chef Server Node\r\n\r\nCreate “chef.json” file in the role folder with the following content. \r\n\r\n    {\r\n      \"name\": \"chef\",\r\n      \"chef_type\": \"role\",\r\n      \"json_class\": \"Chef::Role\",\r\n      \"description\": \"The base role for Chef Server\",\r\n      \"default_attributes\": {\r\n        \"chef-server\": {\r\n          \"version\": \"latest\",\r\n          \"configuration\": {\r\n            \"chef_server_webui\": {\r\n              \"enable\": true\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"run_list\": [\r\n        \"recipe[chef-server::default]\"\r\n      ]\r\n    }\r\n\r\nYou can change or find more info to the above settings at https://github.com/opscode-cookbooks/chef-server/blob/master/attributes/default.rb\r\n\r\nDone ! \r\n\r\n\r\n## Configure Vagrant\r\n\r\nCreate a vagrant intialization file with the following command.\r\n\r\n    vagrant init\r\n    \r\nChange your vagrant to file to:\r\n\r\n    # -*- mode: ruby -*-\r\n    # vi: set ft=ruby :\r\n\r\n    Vagrant.configure(\"2\") do |config|\r\n      config.vm.box = \"precise64\"\r\n      config.vm.box_url = \"http://files.vagrantup.com/precise64.box\"\r\n\r\n      config.vm.network :private_network, ip: \"10.33.33.33\"\r\n      config.vm.network :forwarded_port, guest: 80, host: 8000\r\n      config.vm.network :forwarded_port, guest: 443, host: 8443\r\n\r\n      config.vm.provider :virtualbox do |v|\r\n        v.name = \"chef-server\"\r\n        v.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\r\n        v.customize [\"modifyvm\", :id, \"--memory\", \"1024\"]\r\n      end\r\n\r\n      config.omnibus.chef_version = :latest\r\n      config.berkshelf.enabled = true\r\n\r\n      config.vm.provision :chef_solo do |chef|\r\n        chef.cookbooks_path = \"cookbooks\"\r\n        chef.roles_path = \"roles\"\r\n        chef.data_bags_path = \"data_bags\"\r\n        \r\n        chef.add_role(\"chef\")\r\n      end\r\n    end\r\n\r\nLaunch the virtual machines.\r\n\r\n    $ vagrant up\r\n\r\nVisit https://10.33.33.33/version to check if everything is working.\r\nThen https://10.33.33.33 to access the web interface (admin/p@ssw0rd1).\r\nChange to a secure password and regenerate certificates.\r\n\r\nYou can access your chef server from another computer in the same network with https://your-machine-ip:8443\r\n\r\n\r\nConnect through ssh to copy your chef server keys.\r\n\r\n    $ vagrant ssh chef\r\n    vagrant@precise64:~$ sudo cp /etc/chef-server/*.pem /vagrant/.chef/\r\n\r\n\r\n## Knife configuration\r\n\r\nConfigure knife\r\n\r\n    $ knife configure -i\r\n\r\n- chef server URL: https://10.33.33.33\r\n- clientname: admin\r\n- admin client's private key: .chef/webui.pem\r\n- validation key: .chef/validation.pem\r\n\r\nCheck knife configuration:\r\n\r\n    $ knife client list\r\n    > chef-validator\r\n    > chef-webui\r\n\r\n\r\n**That's it! You're now ready to cook.**\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}